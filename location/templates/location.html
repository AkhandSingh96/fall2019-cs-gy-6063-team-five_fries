{% extends 'base.html' %}
{% block header %}
{% load leaflet_tags %}
{% load static %}
{% leaflet_js %}
{% leaflet_css %}

<script type="text/javascript">
  let latitude = {{ object.latitude }};
  let longitude = {{ object.longitude }};
  window.addEventListener("map:init", (event) => {
    let zoomLevel = 13;
    let map = event.detail.map.setView([latitude, longitude], zoomLevel);
    L.marker([latitude, longitude])
    .addTo(map)
    .bindPopup(`<a target="_blank" href="{{object.google_map_url}}">Open Google Maps</a>`)
    .openPopup();

  });
</script>
{% endblock%}

{% block content %}
<h1>{{object.address}}, {{object.city}}, {{object.state}}, {{object.zipcode}}</h1>
{% leaflet_map "leaflet_map_main" %}

<hr>

<h2>Zillow</h2>
{% if object.zillow_set.all %}
<ul>
{% for zillow in object.zillow_set.all %}
<li>
  <a href={{zillow.url}}>
  <h3>
    {% if zillow.suite_num %}
      <span class="badge badge-secondary">#{{zillow.suite_num}}</span>
    {% endif %}
    {{zillow.estimated_rent_price_for_display}}
  </h3>
  </a>
</li>
{% endfor %}
</ul>
{% else %}
<p>No data from Zillow</p>
{% endif %}
<i>Last update: {{object.last_fetched_zillow}}</i>

<form action="{% url 'location' object.id %}" method="GET">
{#{% csrf_token %}#}
<button type="submit" class="btn secondaryAction btn-outline-primary">Favorite</button>
</form>

{% if favorited %}
    <p>This apartment was added to your favorites.</p>
{% endif %}


{#<form action="{% url 'search' %}" method="GET">#}
{#    <div class="input-group">#}
{#        <input type="text" class="form-control" placeholder="Zip Code (5 digits)" id="zip_code" name="zipcode"#}
{#            minlength="5" maxlength="5" required pattern="\d*">#}
{#        <div class="input-group-append">#}
{#            <input type="submit" class="btn btn-primary" value="Go">#}
{#        </div>#}
{#    </div>#}
{#</form>#}
{% endblock %}
