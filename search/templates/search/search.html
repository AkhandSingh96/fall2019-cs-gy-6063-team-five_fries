{% extends 'base.html' %}

{% load crispy_forms_tags %}

{%  block script %}
<script>
    $(document).ready(function () {
        $("#complaints_button").click(function () {
            $("#complaints").toggle();
        });
    });
</script>

<style>
.meter {
    width: 4rem;
    height: 0.7rem;
    position: relative;
    background: white;
    -moz-border-radius: 25px;
    -webkit-border-radius: 25px;
    border-radius: 25px;
    box-shadow: inset 0 -1px 1px rgba(255,255,255,0.3);
    border-color: lightgray;
    border-width: 1px;
    border-style: solid;
}

    div.meter {
        display: inline-block;
        vertical-align: middle;
    }

.meter > span {
  display: block;
  height: 100%;
  border-top-right-radius: 8px;
  border-bottom-right-radius: 8px;
  border-top-left-radius: 20px;
  border-bottom-left-radius: 20px;
  background-color: orangered;
  background-image: linear-gradient(
    center bottom,
    orangered 37%,
    orangered 69%
  );
  box-shadow:
    inset 0 2px 9px  rgba(255,255,255,0.3),
    inset 0 -2px 6px rgba(0,0,0,0.4);
  position: relative;
  overflow: hidden;
}

.horizontal-list {
    display: flex;
    list-style-type: none;
}
.horizontal-list li {
    margin: 0 0.5rem;
}
#stats-list {
    margin: 0;
    padding: 0;
}
</style>
{% endblock %}

{% block content %}
<div class="container h-100">
    <div class="row justify-content-center h-30">
        <div class="col-12">
            <div class="row">
                <div class="col">
                    <h2>Search All Locations</h2>
                    <form action="{% url 'search' %}" method="GET" class="form-inline">
                        <label class="sr-only" for="zip_code">Zipcode</label>
                        <input type="text" class="form-control mb-2 mr-sm-2" placeholder="Zip Code (5 digits)"
                                        id="zip_code" name="zipcode" minlength="5" maxlength="5" pattern="\d*" required>
                        
                        <label class="sr-only" for="min_price">Min Price</label>
                        <input type="number" class="form-control mb-2 mr-sm-2" placeholder="Min Price" id="min_price"
                                        name="min_price">
                        
                        <label class="sr-only" for="max_price">Max Price</label>
                        <input type="number" class="form-control mb-2 mr-sm-2" placeholder="Max Price" id="max_price"
                                        name="max_price">
                        
                        <input type="submit" class="btn btn-primary mb-2" value="Go">
                    </form>
                </div>
            </div>
        </div>
    </div>
    <br>
    <div>
        <h3>Search results</h3>
        <p>{{ search_title }}</p>
    </div>
    {% if search_data.stats %}
    <p>
        <hr class="mt-0 mb-2 mt-2">
        <div class="horizontal-list">
        <h5>Complaints Level:</h5>
        <span style="margin-left: 0.5rem; color: {{search_data.css_color_for_complaint_level}};">
            {{ search_data.description_for_complaint_level }}
        </span>
        <ul id="stats-list" class="horizontal-list" stype="display: inline-block">
            {% for key, percentage in search_data.stats %}
            <li>
                <span>{{ key }} </span><div class="meter"><span style="width: {{ percentage }}%"></span></div>
            </li>
            {% endfor %}
        </ul>
        <a href="{% url 'data_311'%}?zip_code={{zip}}">See more</a>
        </div>
    </p>
    {% endif %}

    <div>
        <h5>Locations</h5>
        <hr class="mt-0 mb-2 mt-2">
        {% if search_data.locations %}
        <div class="row h-65">
            <div class="col">
                <ul>
                    {% for item in search_data.locations %}
                    <li>
                        <a href="{% url 'location' item.id %}">{{ item.full_address }}</a>
                    </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
        {% else %}
        No locations
        {% endif %}
    </div>

</div>

{% endblock %}